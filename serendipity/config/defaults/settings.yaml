# yaml-language-server: $schema=./settings.schema.json
# Serendipity Settings
# --------------------
# Single source of truth for all configuration.
# To restore defaults: serendipity settings --reset
#
# Schema: serendipity/config/defaults/settings.schema.json

version: 2

# Top-level settings
model: opus
total_count: 10
feedback_server_port: 9876
thinking_tokens: null  # Extended thinking budget (null=disabled, e.g., 10000)

# APPROACHES - How to find recommendations
approaches:
  convergent:
    display_name: "More Like This"
    enabled: true
    prompt_hint: |
      For CONVERGENT recommendations:
      - Match their explicit interests directly
      - Find content from sources they already follow or would recognize
      - Prioritize quality and relevance over novelty
      - These should feel like "of course I'd love this"

  divergent:
    display_name: "Expand Your Palette"
    enabled: true
    prompt_hint: |
      For DIVERGENT recommendations:
      - Find content that shares UNDERLYING qualities, not surface features
      - Cross genre/medium boundaries
      - Look for unexpected connections and lateral moves
      - These should feel like "I never knew I needed this"

# MEDIA - What format of content to recommend
media:
  article:
    display_name: "Articles & Essays"
    enabled: true
    sources:
      - tool: WebSearch
        hints: "{query} essay OR article OR longread"
    prompt_hint: "Prioritize long-form over listicles. Quality publications and personal blogs with voice."
    # preference: "my favorite format"  # optional natural language hint

  youtube:
    display_name: "YouTube Videos"
    enabled: true
    sources:
      - tool: WebSearch
        hints: "site:youtube.com {query}"
    prompt_hint: "Prefer educational content 10-30 minutes long. Avoid clickbait."
    metadata_schema:
      - name: channel
        required: true
      - name: duration
        required: true
    # preference: "only if can't get elsewhere"

  book:
    display_name: "Books"
    enabled: true
    sources:
      - tool: WebSearch
        hints: "site:goodreads.com {query} book"
    prompt_hint: "Mix fiction and non-fiction. Thematic resonance > surface similarity."
    metadata_schema:
      - name: author
        required: true
      - name: year
        required: false
    # preference: "love these"

  podcast:
    display_name: "Podcasts"
    enabled: true
    sources:
      - tool: WebSearch
        hints: "{query} podcast episode"
    prompt_hint: "Can recommend specific episodes OR entire shows."
    metadata_schema:
      - name: show
        required: true
      - name: episode
        required: false
    # preference: "trying to listen more during commutes"

# OUTPUT - Where and how to deliver recommendations
# Separates format (how to render) from destination (where to send)
output:
  default_format: html        # json | markdown | html
  default_destination: browser  # browser | stdout | file | gmail | slack

  destinations:
    browser:
      type: builtin
      enabled: true
      description: "Open in browser with interactive UI"

    stdout:
      type: builtin
      enabled: true
      description: "Print to terminal"

    file:
      type: builtin
      enabled: true
      description: "Save to file only"
      options:
        path: "{profile_dir}/output/"

    gmail:
      type: command
      enabled: true
      description: "Send via Gmail CLI"
      command: "gmail send-summary --to {to} --subject '{subject}'"
      format: markdown  # override format for this destination
      options:
        to: ""  # default recipient (empty = prompt)
        subject: "Serendipity: {date}"

    slack:
      type: webhook
      enabled: false
      description: "Post to Slack channel"
      webhook_url: "${SLACK_WEBHOOK_URL}"  # env var
      format: markdown
      options:
        channel: "#discoveries"

# CONTEXT SOURCES - Where to get user profile/preferences
# Template variables: {profile_dir}, {profile_name}, {home}
context_sources:
  taste:
    type: loader
    enabled: true
    description: "User's aesthetic preferences"
    loader: serendipity.context_sources.builtins.file_loader
    prompt_hint: |
      <persistent_taste>
      {content}
      </persistent_taste>
    options:
      path: "{profile_dir}/taste.md"

  learnings:
    type: loader
    enabled: true
    description: "Extracted patterns from feedback"
    loader: serendipity.context_sources.builtins.file_loader
    prompt_hint: |
      <discovery_learnings>
      {content}
      </discovery_learnings>
    options:
      path: "{profile_dir}/learnings.md"

  history:
    type: loader
    enabled: true
    description: "Recent recommendations and feedback"
    loader: serendipity.context_sources.builtins.history_loader
    prompt_hint: |
      <history_context>
      {content}
      </history_context>
    options:
      max_recent: 20
      include_unextracted: true
      warn_threshold: 10000

  # Example: Shell command source (uncomment to enable)
  # my_notes:
  #   type: command
  #   enabled: true
  #   description: "Load notes via shell command"
  #   command: "cat ~/notes.md | head -100"
  #   timeout: 30  # seconds (default: 30)
  #   prompt_hint: |
  #     <notes>
  #     {content}
  #     </notes>

  # MCP sources (disabled by default)
  whorl:
    type: mcp
    enabled: false  # Enable with: serendipity settings --enable-source whorl
    description: "Personal knowledge base via Whorl"
    server:
      url: http://localhost:{port}/mcp/
      type: http
      headers:
        X-Password: whorl
    health_check:
      endpoint: /health
      timeout: 2.0
    setup:
      cli_command: whorl
      install_hint: "pip install whorled && whorl init"
      home_dir: ~/.whorl
      docs_dir: ~/.whorl/docs/
    port:
      default: 8081
      max_retries: 10
    auto_start:
      enabled: true
      command: ["whorl", "server", "--port", "{port}"]
      log_path: ~/.whorl/server.log
    tools:
      allowed:
        - mcp__whorl__text_search_text_search_post
        - mcp__whorl__agent_search_agent_search_post
        - mcp__whorl__ingest_ingest_post
        - mcp__whorl__bash_bash_post
    prompt_hint: |
      You have access to the user's personal knowledge base via Whorl MCP tools.
      IMPORTANT: Search Whorl FIRST using mcp__whorl__text_search_text_search_post
      to understand their preferences, interests, and past writings before making
      recommendations. This makes your recommendations much more personalized.
